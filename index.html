<!DOCTYPE html>
<html>
  <head>
    <script src="jquery-1.8.0.min.js" type="text/javascript"></script>
    <script>
      window.onload = function() {
        // Init the canvas
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");

        // Load the JSON document
        $.getJSON('Features.js', function(data) {
		  //var newCanvas = document.createElement('canvas');
			
          var croppedImage = new Image();

          // Crop & rotate image on load
          croppedImage.onload = function() {
			var feature = data[0];
            var x0 = feature.corners[0].x;
            var y0 = feature.corners[0].y;
            var x1 = feature.corners[2].x;
            var y1 = feature.corners[2].y;
			var xc = (x0+x1)/2;
			var yc = (y0+y1)/2;
            var sourceWidth = Math.abs(x1 - x0);
            var sourceHeight = Math.abs(y1 - y0);
			//alert('x: '+x0 + ", y: " + y0 + ', angle: ' + feature.angle + '\nx: '+x1 + ", y: " + y1 +'\nw: '+sourceWidth + ", h: " + sourceHeight);

            // Rotate 18 degrees clockwise
			//context.translate(-xc, -yc);
            context.rotate(feature.angle*Math.PI/180);
			//context.translate(xc, yc);

            // See http://canvas.quaese.de/index.php?nav=11,65&doc_id=59
            context.drawImage(croppedImage,
              Math.min(x0, x1), Math.min(y0, y1), sourceWidth, sourceHeight, // Source clip rectangle
              0, 0, sourceWidth, sourceHeight);           // Destination rectangle
          }

          croppedImage.src = document.getElementById("map").src;
        });
      }
    </script>
  </head>
  <body>
    <h1>Original<h1>
    <img id="map" src="British Isles.png" />

    <h1>Cropped &amp; Rotated</h1>
	<div>
    <canvas id="canvas"></div>
  </body>
</html>